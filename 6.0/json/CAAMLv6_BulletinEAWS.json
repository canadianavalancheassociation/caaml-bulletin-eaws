{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "Avalanche Bulletin CAAMLv6",
    "description": "JSON schema for EAWS Avalanche Bulletin following the CAAMLv6 schema",
    "type": "object",
    "properties" : {
        "bulletinID" : {
            "title": "ID of the Bulletin",
            "type" : "string"
        },
        "lang" : { 
            "title": "Language Key of the Bulletin",
            "$ref" : "#/definitions/languageCode"
        },
        "metaData" : { 
            "$ref" : "#/definitions/MetaData" 
        },
        "publicationTime" : {
            "type" : "string",
            "format" : "date-time"
        },
        "validTime" : {
            "$ref" : "#/definitions/validTime"
        },
        "source" : { 
            "$ref" : "#/definitions/source" 
        },
        "region" : {
            "additionalProperties" : {
                "type" : "string"
            }
        },
        "dangerRating" : { 
            "type" : "array",
            "items" : {
              "$ref" : "#/definitions/dangerRating"
            }
        },
        "avalancheProblem" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/definitions/avalancheProblem"
            }
        },
        "tendency" : {
            "type" : "object",
            "properties" : {
                "tendencyType" : {
                    "type" : "string",
                    "enum" : [ "decreasing", "steady", "increasing"]
                },
                "validTime" : {
                    "$ref" : "#/definitions/validTime"
                }
            }
        },
        "highlights" : {
            "type" : "string"
        },
        "avalancheActivityHighlights" : {
            "type" : "string"
        },
        "avalancheActivityComment" : {
            "type" : "string"
        },
        "snowpackStructureComment" : {
            "type" : "string"
        },
        "tendencyComment" : {
            "type" : "string"
        }        
    },
    
    "definitions" : {
        "languageCode" : {
            "title": "Language Code",
            "description": "Two-letter language codes (ISO 639-1).",
            "type" : "string",
            "minLength" : 2,
            "maxLength" : 2
        },
        "validTime" : {
            "type" : "object",
            "properties" : {
                "startTime" : {
                    "type" : "string",
                    "format" : "date-time"
                },
                "endTime" : {
                    "type" : "string",
                    "format" : "date-time"
                }
            }
        },
        "source" : {
            "type" : "object",
            "properties" : {
                "provider" : { "$ref" : "#/definitions/provider" }
            }
        },
        "provider" : {
            "type" : "object",
            "properties" : {
                "name" : {
                    "type" : "string"
                },
                "website" : {
                    "type" : "string",
                    "format" : "uri"
                }
            }
        },
        "dangerRating" : {
            "title" : "Danger Rating",
            "description" : "Danger rating used in an avalanche bulletin.",
            "properties" : {
                "mainValue": { "$ref" : "#/definitions/dangerRatingValue" },
                "elevation" : { "$ref" : "#/definitions/elevation" },
                "aspect" : { "$ref" : "#/definitions/aspect" },
                "terrainFeature" : { "type" : "string" },
                "artificialDangerRating" : { "$ref" : "#/definitions/dangerRatingValue" },
                "artificialAvalancheSize" : {
                    "type" : "number",
                    "minimum" : 1,
                    "maximum" : 5
                },
                "artificialAvalancheReleaseProbability" : {
                    "type" : "number",
                    "minimum" : 1,
                    "maximum" : 4
                },
                "artificialHazardSiteDistribution" : {
                    "type" : "number",
                    "minimum" : 1,
                    "maximum" : 5
                },
                "naturalDangerRating" : { "$ref" : "#/definitions/dangerRatingValue" },
                "naturalAvalancheReleaseProbability" : {
                    "type" : "number",
                    "minimum" : 1,
                    "maximum" : 4
                },
                "naturalHazardSiteDistribution" : {
                    "type" : "number",
                    "minimum" : 1,
                    "maximum" : 5
                },
                "comment" : { "type" : "string" },
                "customData" : { "$ref" : "#/definitions/customData" }
            }
        },     
        "avalancheProblem" : {
            "type" : "object",
            "properties" : {
                "mainValue": { "$ref" : "#/definitions/dangerRatingValue" },
                "dangerRating" : { "$ref" : "#/definitions/dangerRating" },
                "problemType" : { "$ref" : "#/definitions/avalancheProblemType" }
            }
        },
        "elevation" : {
            "type" : "object",
            "properties" : {
                "lowerBound" : { 
                    "type" : "string",
                    "pattern" : "^[0-9]+$|treeline$"
                },
                "upperBound" : { 
                    "type" : "string",
                    "pattern" : "^[0-9]+$|treeline$"
                }
            }
        },
        "aspect" : {
            "title" : "Aspect",
            "description" : "All aspects.",
            "customData" : { "$ref" : "#/definitions/customData" },
            "type" : "array",
            "items" : {
              "type" : "string",
              "enum" : [ "N", "NE", "E", "SE", "S", "SW", "W", "NW", "n/a" ]
            }
        },
        "dangerRatingValue" : {
            "type" : "string",
            "enum" : [ "no_snow", "no_rating", "low", "moderate", "considerable", "high", "very_high" ]
        },
        "avalancheProblemType" : {
            "title" : "Avalanche Problem",
            "description" : "The six avalanche problems.",
            "type" : "string",
            "enum" : [ "new_snow", "wind_drifted_snow", "persistent_weak_layers", "wet_snow", "gliding_snow", "cornice_failure", "favourable_situation" ]
        },
        "MetaData" : {
            "extFile" : { "$ref" : "#/definitions/ExtFileType" },
            "comment" : "string",
            "customData" : { "$ref" : "#/definitions/customData" }
        },
        "ExtFileType" : {
            "title" : "External files",
            "description" : "Reference to external files assocciated with this bulletin.",
            "type" : "object",
            "properties" : {
              	"fileType" : { "$ref" : "#/definitions/ExtFileTypeType" },
                "fileReferenceURI" : {
                    "type" : "string",
                    "format" : "uri"
                },
                "customData" : { "$ref" : "#/definitions/customData" }
            }
        },
        "ExtFileTypeType" : {
            "type" : "string",
            "enum" : [ "dangerRatingMapOverlay", "dangerRatingMap", "printOut", "website" ]
        },
        "customData" : {
        }
    }
}
