{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "Avalanche Bulletin CAAMLv6",
    "description": "JSON schema for EAWS Avalanche Bulletin following the CAAMLv6 schema",
    "type": "object",
    "properties" : {
        "bulletins" : {
            "type" : "array",
            "items" : {
                "$ref" : "#/definitions/bulletin"
            }
        },
        "metaData" : { "$ref" : "#/definitions/metaData" },
        "customData" : { "$ref" : "#/definitions/customData" }
    },
    
    "definitions" : {
        "bulletin" : {
            "title" : "Danger Rating",
            "description" : "Danger rating used in an avalanche bulletin.",
            "properties": {
                "bulletinID" : { "type" : "string" },
                "lang" : { "$ref" : "#/definitions/languageCode" },
                "publicationTime" : {
                    "type" : "string",
                    "format" : "date-time"
                },
                "validTime" : { "$ref" : "#/definitions/validTime" },
                "source" : { "$ref" : "#/definitions/source" },
                "regions" : {
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/region"
                    }
                },
                "dangerRatings" : { 
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/dangerRating"
                    }
                },
                "avalancheProblems" : {
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/avalancheProblem"
                    }
                },
                "tendency" : { "$ref" : "#/definitions/tendencyType"},
                "highlights" : { "type" : "string" },
                "wxSynopsisHighlights" : { "type" : "string" },
                "wxSynopsisComment" : { "type" : "string" },
                "avalancheActivityHighlights" : { "type" : "string" },
                "avalancheActivityComment" : { "type" : "string" },
                "snowpackStructureHighlights" : { "type" : "string" },
                "snowpackStructureComment" : { "type" : "string" },
                "travelAdvisoryHighlights" : { "type" : "string" },
                "travelAdvisoryComment" : { "type" : "string" },
                "tendencyComment" : { "type" : "string" },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties" : false
        },
        "dangerRating" : {
            "title" : "Danger Rating",
            "description" : "Danger rating used in an avalanche bulletin.",
            "properties" : {
                "mainValue": { "$ref" : "#/definitions/dangerRatingValue" },
                "elevation" : { "$ref" : "#/definitions/elevation" },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },     
        "dangerRatingValue" : {
            "type" : "string",
            "enum" : [ "low", "moderate", "considerable", "high", "very_high", "no_snow", "no_rating" ]
        },
        "avalancheProblem" : {
            "title" : "Avalanche Problem",
            "description" : "Definition of an avalanche problem.",
            "type" : "object",
            "properties" : {
                "problemType" : { "$ref" : "#/definitions/avalancheProblemType" },
                "elevation" : { "$ref" : "#/definitions/elevation" },
                "aspects" : { "$ref" : "#/definitions/aspects" },
                "terrainFeature" : { "type" : "string" },
                "avalancheSize" : { "$ref" : "#/definitions/avalancheSizeType" },
                "snowpackStability" : { "$ref" : "#/definitions/snowpackStabilityType" },
                "frequency" : { "$ref" : "#/definitions/frequencyType" },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },
        "avalancheProblemType" : {
            "title" : "Avalanche Problem Type",
            "description" : "The six avalanche problems.",
            "type" : "string",
            "enum" : [ "new_snow", "wind_drifted_snow", "persistent_weak_layers", "wet_snow", "gliding_snow", "cornice_failure", "favourable_situation" ]
        },
        "avalancheSizeType" : {
            "title" : "Avalanche Size",
            "description": "The avalanche size defined by the EAWS.",
            "type" : "number",
            "minimum" : 1,
            "maximum" : 5
        },
        "snowpackStabilityType" : {
            "title": "Snowpack Stability",
            "description": "The snowpack stability class defined by EAWS",
            "type" : "string",
            "enum" : [ "very_poor", "poor", "fair", "good"]
        },
        "frequencyType" : {
            "title": "Frequency",
            "description": "The frequency of instable points defined by EAWS",
            "type" : "string",
            "enum" : [ "few", "some", "many"]
        },
        "tendencyType" : {
            "type" : "object",
            "properties" : {
                "tendencyType" : {
                    "type" : "string",
                    "enum" : [ "decreasing", "steady", "increasing"]
                },
                "validTime" : {
                    "$ref" : "#/definitions/validTime"
                },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },
        "metaData" : {
            "title" : "Meta Data",
            "description" : "Additional information.",
            "type" : "object",
            "properties": {
                "extFile" : { "$ref" : "#/definitions/ExtFileType" },
                "comment" : { "type" : "string" }
            },
            "additionalProperties": false
        },
        "ExtFileType" : {
            "title" : "External files",
            "description" : "Reference to external files assocciated with this bulletin.",
            "type" : "object",
            "properties" : {
              	"fileType" : { "$ref" : "#/definitions/ExtFileTypeType" },
                "description" : { "type" : "string" },
                "fileReferenceURI" : {
                    "type" : "string",
                    "format" : "uri"
                }
            },
            "additionalProperties": false
        },
        "ExtFileTypeType" : {
            "type" : "string",
            "enum" : [ "dangerRatingMapOverlay", "dangerRatingMap", "printOut", "website" ]
        },
        "customData" : {
        },
        "source" : {
            "type" : "object",
            "properties" : {
                "oneOf" : {
                    "provider" : { "$ref" : "#/definitions/provider" },
                    "person" : { "$ref" : "#/definitions/person" }
                }
            },
            "additionalProperties": false
        },
        "provider" : {
            "type" : "object",
            "properties" : {
                "name" : {
                    "type" : "string"
                },
                "website" : {
                    "type" : "string",
                    "format" : "uri"
                },
                "contactPerson" : { "$ref" : "#/definitions/person" },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },
        "person" : {
            "type" : "object",
            "properties" : {
                "name" : {
                    "type" : "string"
                },
                "website" : {
                    "type" : "string",
                    "format" : "uri"
                },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },
        "region" : {
            "type" : "object",
            "properties": {
                "id" : { "type" : "string" },
                "name" : { "type" : "string" },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },
        "aspects" : {
            "title" : "Aspect",
            "description" : "All aspects.",
            "type" : "array",
            "items" : {
              "type" : "string",
              "enum" : [ "N", "NE", "E", "SE", "S", "SW", "W", "NW", "n/a" ]
            }
        },
        "elevation" : {
            "type" : "object",
            "properties" : {
                "lowerBound" : { 
                    "type" : "string",
                    "pattern" : "^[0-9]+$|treeline$"
                },
                "upperBound" : { 
                    "type" : "string",
                    "pattern" : "^[0-9]+$|treeline$"
                }
            },
            "additionalProperties": false
        },
        "validTime" : {
            "type" : "object",
            "properties" : {
                "startTime" : {
                    "type" : "string",
                    "format" : "date-time"
                },
                "endTime" : {
                    "type" : "string",
                    "format" : "date-time"
                }
            },
            "additionalProperties": false
        },
        "languageCode" : {
            "title": "Language Code",
            "description": "Two-letter language codes (ISO 639-1).",
            "type" : "string",
            "minLength" : 2,
            "maxLength" : 2
        }
    },
    "additionalProperties": false
}
