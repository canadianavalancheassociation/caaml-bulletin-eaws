{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Avalanche Bulletin CAAMLv6 Collection",
    "description": "JSON schema for EAWS Avalanche Bulletin Collection following the CAAMLv6 schema",
    "type": "object",
    "required": ["bulletins"],
    "properties" : {
        "bulletins" : {
            "type" : "array",
            "items" : {
                "$ref" : "#/definitions/bulletin"
            }
        },
        "metaData" : { "$ref" : "#/definitions/metaData" },
        "customData" : { "$ref" : "#/definitions/customData" }
    },
    
    "definitions" : {
        "bulletin" : {
            "type" : "object",
            "properties": {
                "bulletinID" : { "type" : "string" },
                "lang" : { "$ref" : "#/definitions/languageCode" },
                "publicationTime" : {
                    "type" : "string",
                    "format" : "date-time"
                },
                "validTime" : { "$ref" : "#/definitions/validTime" },
                "source" : { "$ref" : "#/definitions/source" },
                "regions" : {
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/region"
                    }
                },
                "dangerRatings" : { 
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/dangerRating"
                    }
                },
                "avalancheProblems" : {
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/avalancheProblem"
                    }
                },
                "highlights" : { "type" : "string" },
                "wxSynopsis" : { "$ref" : "#/definitions/texts" },
                "avalancheActivity" : { "$ref" : "#/definitions/texts" },
                "snowpackStructure" : { "$ref" : "#/definitions/texts" },
                "travelAdvisory" : { "$ref" : "#/definitions/texts" },
                "tendency" : { "$ref" : "#/definitions/tendency"},
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties" : false
        },
        "dangerRating" : {
            "type" : "object",
            "properties" : {
                "mainValue": { "$ref" : "#/definitions/dangerRatingValue" },
                "elevation" : { "$ref" : "#/definitions/elevation" },
                "aspects" : { "$ref" : "#/definitions/aspects" },
                "validTimePeriod" : { "$ref" : "#/definitions/validTimePeriod" },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },     
        "dangerRatingValue" : {
            "type" : "string",
            "enum" : [ "low", "moderate", "considerable", "high", "very_high", "no_snow", "no_rating" ]
        },
        "avalancheProblem" : {
            "type" : "object",
            "properties" : {
                "problemType" : { "$ref" : "#/definitions/avalancheProblemType" },
                "elevation" : { "$ref" : "#/definitions/elevation" },
                "aspects" : { "$ref" : "#/definitions/aspects" },
                "validTimePeriod" : { "$ref" : "#/definitions/validTimePeriod" },
                "terrainFeature" : { "type" : "string" },
                "avalancheSize" : { "$ref" : "#/definitions/avalancheSize" },
                "snowpackStability" : { "$ref" : "#/definitions/snowpackStability" },
                "frequency" : { "$ref" : "#/definitions/frequency" },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },
        "avalancheProblemType" : {
            "type" : "string",
            "enum" : [ "new_snow", "wind_drifted_snow", "persistent_weak_layers", "wet_snow", "gliding_snow", "cornice_failure", "favourable_situation" ]
        },
        "avalancheSize" : {
            "type" : "number",
            "minimum" : 1,
            "maximum" : 5
        },
        "snowpackStability" : {
            "type" : "string",
            "enum" : [ "very_poor", "poor", "fair", "good"]
        },
        "frequency" : {
            "type" : "string",
            "enum" : [ "few", "some", "many"]
        },
        "tendency" : {
            "type" : "object",
            "properties" : {
                "highlights" : {
                    "type" : "string"
                },
                "comment" : {
                    "type" : "string"
                },
                "tendencyType" : {
                    "type" : "string",
                    "enum" : [ "decreasing", "steady", "increasing"]
                },
                "validTime" : {
                    "$ref" : "#/definitions/validTime"
                },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            }
        },
        "metaData" : {
            "type" : "object",
            "properties": {
                "extFiles" : { 
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/extFile"
                    }
                },
                "comment" : { "type" : "string" }
            },
            "additionalProperties": false
        },
        "extFile" : {
            "type" : "object",
            "properties" : {
              	"fileType" : { "type" : "string" },
                "description" : { "type" : "string" },
                "fileReferenceURI" : {
                    "type" : "string",
                    "format" : "uri"
                }
            },
            "additionalProperties": false
        },
        "customData" : {
        },
        "texts" : {
            "type" : "object",
            "properties" : {
                "highlights" : {
                    "type" : "string"
                },
                "comment" : {
                    "type" : "string"
                }
            },
            "additionalProperties": false
        },
        "source" : {
            "type" : "object",
            "properties": {
                "provider" : { "$ref" : "#/definitions/provider" },
                "contactPerson" : { "$ref" : "#/definitions/person" }
            },
            "oneOf" : [
                { "required" : [ "provider" ] },
                { "required" : [ "person" ] }
            ],
            "additionalProperties": false
        },
        "provider" : {
            "type" : "object",
            "properties" : {
                "name" : {
                    "type" : "string"
                },
                "website" : {
                    "type" : "string",
                    "format" : "uri"
                },
                "contactPerson" : { "$ref" : "#/definitions/person" },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },
        "person" : {
            "type" : "object",
            "properties" : {
                "name" : {
                    "type" : "string"
                },
                "website" : {
                    "type" : "string",
                    "format" : "uri"
                },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },
        "region" : {
            "type" : "object",
            "properties": {
                "regionId" : { "type" : "string" },
                "name" : { "type" : "string" },
                "metaData" : { "$ref" : "#/definitions/metaData" },
                "customData" : { "$ref" : "#/definitions/customData" }
            },
            "additionalProperties": false
        },
        "aspects" : {
            "type" : "array",
            "items" : {
              "type" : "string",
              "enum" : [ "N", "NE", "E", "SE", "S", "SW", "W", "NW", "n/a" ]
            }
        },
        "elevation" : {
            "type" : "object",
            "properties" : {
                "lowerBound" : { 
                    "type" : "string",
                    "pattern" : "treeline|0|[1-9][0-9]*[0][0]+"
                },
                "upperBound" : { 
                    "type" : "string",
                    "pattern" : "treeline|0|[1-9][0-9]*[0][0]+"
                }
            },
            "additionalProperties": false
        },
        "validTime" : {
            "type" : "object",
            "properties" : {
                "startTime" : {
                    "type" : "string",
                    "format" : "date-time"
                },
                "endTime" : {
                    "type" : "string",
                    "format" : "date-time"
                }
            },
            "additionalProperties": false
        },
        "validTimePeriod" : {
            "type" : "string",
            "enum" : [ "all_day", "earlier", "later" ]
        },
        "languageCode" : {
            "title": "Language Code",
            "description": "Two-letter language code (ISO 639-1).",
            "type" : "string",
            "minLength" : 2,
            "maxLength" : 2
        }
    },
    "additionalProperties": false
}
